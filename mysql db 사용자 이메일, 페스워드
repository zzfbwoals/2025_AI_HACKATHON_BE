-- 데이터베이스 생성
CREATE DATABASE myapp CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE myapp;

-- 1️ character 테이블 (캐릭터 정보)
CREATE TABLE characters (
    id INT AUTO_INCREMENT PRIMARY KEY,   -- 캐릭터 고유 ID
    name VARCHAR(50) NOT NULL,           -- 캐릭터 이름
    description VARCHAR(255),            -- 캐릭터 설명
    personality VARCHAR(100)             -- 캐릭터 특징
);

-- 2️ User 테이블 (부모 + 자녀 + 구독 정보)
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,          -- 부모(사용자) 고유 ID
    character_id INT,                           -- 연결된 캐릭터 ID (FK)
    name VARCHAR(50) NOT NULL,                  -- 부모 이름
    email VARCHAR(100) NOT NULL UNIQUE,         -- 이메일 (중복 불가)
    password VARCHAR(255) NOT NULL,             -- 비밀번호
    child_name VARCHAR(50) NOT NULL,            -- 아이 이름
    child_age INT,                              -- 아이 나이
    subscribe VARCHAR(20) DEFAULT 'Free',       -- 구독 플랜 (기본 Free)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 생성 시각 자동 저장

    FOREIGN KEY (character_id) REFERENCES characters(id)
        ON UPDATE CASCADE
        ON DELETE SET NULL
);

-- 3️ Routine 테이블 (아이의 루틴 정보)
CREATE TABLE routine (
    id INT AUTO_INCREMENT PRIMARY KEY,          -- 루틴 고유 ID
    user_id INT NOT NULL,                       -- 부모(사용자) ID (FK)
    routin VARCHAR(100) NOT NULL,               -- 루틴 이름
    routine_time DATETIME NOT NULL,             -- 루틴 시간
    routine_content VARCHAR(255) NOT NULL,      -- 루틴 내용
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 생성일자
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, -- 업데이트일자

    FOREIGN KEY (user_id) REFERENCES users(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

-- 4️ Routine Option 테이블 (루틴 세부 옵션)
CREATE TABLE routine_options (
    id INT AUTO_INCREMENT PRIMARY KEY,          -- 옵션 고유 ID
    routine_id INT NOT NULL,                    -- 루틴 ID (FK)
    minut INT,                                  -- 분
    option_content VARCHAR(255),                -- 옵션 내용

    FOREIGN KEY (routine_id) REFERENCES routine(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

-- 5️ Learning Contents 테이블 (학습 콘텐츠)
CREATE TABLE learning_contents (
    id INT AUTO_INCREMENT PRIMARY KEY,          -- 콘텐츠 고유 ID
    user_id INT NOT NULL,                       -- 사용자 ID (FK)
    title VARCHAR(100) NOT NULL,                -- 콘텐츠 제목
    description TEXT,                           -- 콘텐츠 설명
    category VARCHAR(50),                       -- 콘텐츠 종류
    content_type VARCHAR(50),                   -- 형식 (예: 동영상, 게임, 퀴즈 등)
    url VARCHAR(255),                           -- 링크
    difficulty VARCHAR(20),                     -- 난이도
    recommended_time INT,                       -- 권장 시청 시간 (분 단위)

    FOREIGN KEY (user_id) REFERENCES users(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);
